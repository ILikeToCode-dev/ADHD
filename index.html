<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ThinkSharp: ADHD Focus Quiz</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(2vh); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-2vw); }
      to { opacity: 1; transform: translateX(0); }
    }
    .fade-in { animation: fadeIn 0.5s ease-out; }
    .slide-in { animation: slideIn 0.5s ease-out; }
    .circle {
      transition: transform 0.2s ease, background-color 0.2s ease;
    }
    .circle:hover {
      transform: scale(1.1);
      cursor: pointer;
    }
    .task-item {
      transition: all 0.3s ease;
    }
    .task-item:hover {
      transform: translateX(0.5vw);
      background-color: #f3f4f6;
    }
    .loader-dot {
      animation: pulse 1.5s ease-in-out infinite;
      animation-delay: calc(0.2s * var(--i));
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 0.5; }
      50% { transform: scale(1.5); opacity: 1; }
    }
    @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
      .circle, .task-icon {
        transform: scale(1.5);
      }
      .circle:hover, .task-item:hover .task-icon {
        transform: scale(1.65);
      }
    }
    .loader-hidden {
      display: none !important;
      animation: none !important;
    }
    .disabled {
      opacity: 0.5;
      pointer-events: none;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-[100vh] flex items-center justify-center">
  <div id="app" class="w-[90vw] max-w-[600px] min-w-[300px] mx-auto p-[4vw] sm:p-[2vw] bg-white rounded-xl shadow-lg">
    <div id="loader" class="flex justify-center items-center h-[40vh] sm:h-[30vh]">
      <div class="flex space-x-[1vw]">
        <div class="w-[2vw] h-[2vw] min-w-[8px] min-h-[8px] bg-blue-500 rounded-full loader-dot" style="--i: 0;"></div>
        <div class="w-[2vw] h-[2vw] min-w-[8px] min-h-[8px] bg-blue-500 rounded-full loader-dot" style="--i: 1;"></div>
        <div class="w-[2vw] h-[2vw] min-w-[8px] min-h-[8px] bg-blue-500 rounded-full loader-dot" style="--i: 2;"></div>
      </div>
    </div>
    <div id="quiz" class="quiz-container hidden">
      <div class="question text-[1.2rem] sm:text-[1.5rem] font-semibold text-gray-800 mb-[2vh] text-center" id="question">
        <p>Loading...</p>
      </div>
      <div class="options flex flex-wrap justify-between gap-[1vw] mb-[2vh]" id="options"></div>
      <div class="labels flex justify-between text-[0.8rem] sm:text-[0.9rem] text-gray-600">
        <span>Never</span>
        <span>Rarely</span>
        <span>Sometimes</span>
        <span>Often</span>
        <span>Always</span>
      </div>
    </div>
    <div id="result-screen" class="hidden">
      <div class="quiz-result text-[1.5rem] sm:text-[2rem] font-bold text-center mb-[2vh]" id="score"></div>
      <div class="task-list space-y-[1vh]" id="tasks"></div>
      <button class="retake-btn mt-[2vh] w-full py-[1vh] bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-[1rem] sm:text-[1.1rem]" onclick="resetQuiz()">Retake Quiz</button>
    </div>
  </div>

  <audio id="meditationMusic" src="meditation_music.mp3" loop></audio>
  <audio id="startSound" src="start_sound.mp3"></audio>
  <audio id="endSound" src="end_sound.mp3"></audio>
  <audio id="rewardSound" src="reward_sound.mp3"></audio>

  <script>
    const questions = [
      { q: "You find it hard to sit still for long periods.", scores: [0, 1, 2, 3, 4] },
      { q: "You get distracted easily during tasks.", scores: [0, 1, 2, 3, 4] },
      { q: "You have trouble organizing tasks or activities.", scores: [0, 1, 2, 3, 4] },
      { q: "You frequently forget things like appointments or obligations.", scores: [0, 1, 2, 3, 4] },
      { q: "You feel like your thoughts are racing and hard to control.", scores: [0, 1, 2, 3, 4] }
    ];
    const tasksBySeverity = {
      mild: [
        { text: "Try a 5-minute mindfulness breathing exercise after each task.", action: 'meditation' },
        { text: "Use a Pomodoro timer: 25 minutes focus, 5 minutes break.", action: 'pomodoro' },
        { text: "Keep a notepad for quick jotting of to-dos.", action: 'notepad' }
      ],
      moderate: [
        { text: "Designate a distraction-free workspace with minimal stimuli.", action: 'workspace' },
        { text: "Create a daily checklist each morning and tick off items.", action: 'checklist' },
        { text: "Use a focus-blocking app for 45-minute sessions.", action: 'focusBlock' }
      ],
      severe: [
        { text: "Break tasks into 5-minute micro-tasks and reward yourself after each.", action: 'microTask' },
        { text: "Schedule structured cycles: 15 minutes work / 5 minutes move/stretch.", action: 'workStretch' },
        { text: "Pair with an accountability buddy and check in hourly.", action: 'accountability' }
      ]
    };

    let current = 0, total = 0;
    const maxScore = questions.length * 4;
    let timerInterval = null;
    let pomodoroPhase = 'focus';
    let pomodoroCycles = 0;
    let currentActiveTask = null;
    let notepadStates = {};

    window.onload = () => {
      document.getElementById('loader').classList.add('loader-hidden');
      setTimeout(() => {
        document.getElementById('loader').classList.add('loader-hidden');
        document.getElementById('quiz').classList.remove('hidden');
        document.getElementById('quiz').classList.add('fade-in');
        loadQuestion();
      }, 1500);
    };

    function loadQuestion() {
      const q = questions[current];
      if (!q) {
        console.error('Question not found for index:', current);
        return;
      }
      document.getElementById('loader').classList.add('loader-hidden');
      const questionEl = document.getElementById('question');
      questionEl.innerHTML = `<p class="slide-in">${q.q}</p>`;
      const opts = document.getElementById('options');
      opts.innerHTML = '';
      ['Never', 'Rarely', 'Sometimes', 'Often', 'Always'].forEach((label, i) => {
        const c = document.createElement('div');
        c.className = `circle w-[10vw] h-[10vw] min-w-[40px] min-h-[40px] max-w-[60px] max-h-[60px] rounded-full ${['bg-red-400', 'bg-orange-400', 'bg-yellow-400', 'bg-green-400', 'bg-blue-400'][i]} flex items-center justify-center text-white font-semibold`;
        c.setAttribute('title', label);
        c.textContent = label.charAt(0);
        c.onclick = () => select(i);
        opts.appendChild(c);
      });
      setTimeout(() => {
        opts.querySelectorAll('.circle').forEach((el, i) => {
          el.style.animationDelay = `${i * 0.1}s`;
          el.classList.add('slide-in');
        });
      }, 10);
    }

    function select(idx) {
      total += questions[current].scores[idx];
      current++;
      if (current < questions.length) {
        loadQuestion();
      } else {
        showResult();
      }
    }

    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
    }

    function startTimer(duration, display, onEnd, onTick = () => {}) {
      let timeLeft = duration;
      display.textContent = formatTime(timeLeft);
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        timeLeft--;
        display.textContent = formatTime(timeLeft);
        onTick();
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          onEnd();
        }
      }, 1000);
    }

    function disableTaskButtons(exceptIndex = null) {
      document.querySelectorAll('.task-item button:not(.retake-btn)').forEach(btn => {
        if (exceptIndex !== null && btn.parentElement.id.includes(`${exceptIndex}`)) return;
        btn.classList.add('disabled');
      });
    }

    function enableTaskButtons() {
      document.querySelectorAll('.task-item button').forEach(btn => {
        btn.classList.remove('disabled');
      });
    }

    function showResult() {
      document.getElementById('quiz').classList.add('hidden');
      document.getElementById('loader').classList.add('loader-hidden');
      const percent = Math.round((total / maxScore) * 100);
      const scoreEl = document.getElementById('score');
      scoreEl.textContent = `Focus Score: ${percent}%`;
      scoreEl.className = `quiz-result text-[1.5rem] sm:text-[2rem] font-bold text-center mb-[2vh] fade-in ${percent < 40 ? 'text-green-500' : percent <= 70 ? 'text-yellow-500' : 'text-red-500'}`;

      let severity = percent < 40 ? 'mild' : percent <= 70 ? 'moderate' : 'severe';
      const tasksEl = document.getElementById('tasks');
      tasksEl.innerHTML = '';
      tasksBySeverity[severity].forEach((task, i) => {
        const div = document.createElement('div');
        div.className = 'task-item flex items-center space-x-[1vw] slide-in';
        div.style.animationDelay = `${i * 0.2}s`;
        let actionHtml = '';
        if (task.action === 'meditation') {
          actionHtml = `
            <button onclick="startMeditation(${i})" class="ml-[1vw] py-[0.5vh] px-[1vw] bg-blue-500 text-white rounded hover:bg-blue-600">Start</button>
            <div id="meditationTimer${i}" class="hidden ml-[1vw]">
              <span id="meditationDisplay${i}" class="text-[0.9rem]"></span>
              <button onclick="stopMeditation(${i})" class="ml-[1vw] py-[0.5vh] px-[1vw] bg-red-500 text-white rounded hover:bg-red-600">Stop</button>
            </div>`;
        } else if (task.action === 'pomodoro') {
          actionHtml = `
            <button onclick="startPomodoro(${i})" class="ml-[1vw] py-[0.5vh] px-[1vw] bg-blue-500 text-white rounded hover:bg-blue-600">Start</button>
            <div id="pomodoroTimer${i}" class="hidden ml-[1vw]">
              <span id="pomodoroDisplay${i}" class="text-[0.9rem]"></span>
              <button onclick="stopPomodoro(${i})" class="ml-[1vw] py-[0.5vh] px-[1vw] bg-red-500 text-white rounded hover:bg-red-600">Stop</button>
            </div>`;
        } else if (task.action === 'notepad') {
          actionHtml = `
            <div class="ml-[1vw] w-full">
              <textarea id="notepad${i}" class="w-[60vw] p-[1vw] border rounded text-[0.9rem]" placeholder="Jot down your to-dos..."></textarea>
              <div class="flex space-x-[1vw] mt-[0.5vh]">
                <button onclick="saveNotepad(${i})" class="py-[0.5vh] px-[1vw] bg-blue-500 text-white rounded hover:bg-blue-600">Save</button>
                <button onclick="clearNotepad(${i})" class="py-[0.5vh] px-[1vw] bg-gray-500 text-white rounded hover:bg-gray-600">Clear</button>
              </div>
              <div id="notepadList${i}" class="mt-[1vh] text-[0.9rem]"></div>
            </div>`;
        } else if (task.action === 'workspace') {
          actionHtml = `<p class="ml-[1vw] text-[0.9rem] italic">Clear your desk and silence notifications!</p>`;
        } else if (task.action === 'checklist') {
          actionHtml = `
            <div class="ml-[1vw]">
              <input id="checklistInput${i}" class="p-[0.5vw] border rounded text-[0.9rem]" placeholder="Add task...">
              <button onclick="addChecklistItem(${i})" class="ml-[0.5vw] py-[0.5vh] px-[1vw] bg-blue-500 text-white rounded hover:bg-blue-600">Add</button>
              <div id="checklist${i}" class="mt-[1vh]"></div>
            </div>`;
        } else if (task.action === 'focusBlock') {
          actionHtml = `
            <button onclick="startFocusBlock(${i})" class="ml-[1vw] py-[0.5vh] px-[1vw] bg-blue-500 text-white rounded hover:bg-blue-600">Start</button>
            <div id="focusBlockTimer${i}" class="hidden ml-[1vw]">
              <span id="focusBlockDisplay${i}" class="text-[0.9rem]"></span>
              <button onclick="stopFocusBlock(${i})" class="ml-[1vw] py-[0.5vh] px-[1vw] bg-red-500 text-white rounded hover:bg-red-600">Stop</button>
            </div>`;
        } else if (task.action === 'microTask') {
          actionHtml = `
            <button onclick="startMicroTask(${i})" class="ml-[1vw] py-[0.5vh] px-[1vw] bg-blue-500 text-white rounded hover:bg-blue-600">Start</button>
            <div id="microTaskTimer${i}" class="hidden ml-[1vw]">
              <span id="microTaskDisplay${i}" class="text-[0.9rem]"></span>
              <button onclick="completeMicroTask(${i})" class="ml-[1vw] py-[0.5vh] px-[1vw] bg-green-500 text-white rounded hover:bg-green-600">Done</button>
              <button onclick="stopMicroTask(${i})" class="ml-[1vw] py-[0.5vh] px-[1vw] bg-red-500 text-white rounded hover:bg-red-600">Stop</button>
            </div>`;
        } else if (task.action === 'workStretch') {
          actionHtml = `
            <button onclick="startWorkStretch(${i})" class="ml-[1vw] py-[0.5vh] px-[1vw] bg-blue-500 text-white rounded hover:bg-blue-600">Start</button>
            <div id="workStretchTimer${i}" class="hidden ml-[1vw]">
              <span id="workStretchDisplay${i}" class="text-[0.9rem]"></span>
              <button onclick="stopWorkStretch(${i})" class="ml-[1vw] py-[0.5vh] px-[1vw] bg-red-500 text-white rounded hover:bg-red-600">Stop</button>
            </div>`;
        } else if (task.action === 'accountability') {
          actionHtml = `<input id="accountability${i}" class="ml-[1vw] p-[0.5vw] border rounded text-[0.9rem]" placeholder="Enter buddy's contact info...">`;
        }
        div.innerHTML = `
          <svg class="task-icon w-[5vw] h-[5vw] min-w-[20px] min-h-[20px] max-w-[30px] max-h-[30px] text-${severity === 'mild' ? 'green' : severity === 'moderate' ? 'yellow' : 'red'}-500" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="10" fill="currentColor"/>
            <path d="M10 15l-3-3 1.5-1.5L10 12l5-5 1.5 1.5z" fill="white"/>
          </svg>
          <p class="text-gray-700 text-[0.9rem] sm:text-[1rem]">${task.text}</p>
          ${actionHtml}`;
        tasksEl.appendChild(div);
      });
      document.getElementById('result-screen').classList.remove('hidden');
      document.getElementById('result-screen').classList.add('fade-in');
    }

    function resetQuiz() {
      current = total = 0;
      currentActiveTask = null;
      notepadStates = {};
      stopAllTimers();
      document.getElementById('loader').classList.add('loader-hidden');
      document.getElementById('result-screen').classList.add('hidden');
      document.getElementById('quiz').classList.remove('hidden');
      document.getElementById('quiz').classList.add('fade-in');
      loadQuestion();
    }

    function stopAllTimers() {
      clearInterval(timerInterval);
      document.getElementById('meditationMusic').pause();
      document.getElementById('meditationMusic').currentTime = 0;
      document.querySelectorAll('[id^="meditationTimer"],[id^="pomodoroTimer"],[id^="focusBlockTimer"],[id^="microTaskTimer"],[id^="workStretchTimer"]').forEach(el => el.classList.add('hidden'));
      currentActiveTask = null;
      enableTaskButtons();
    }

    // Meditation
    function startMeditation(index) {
      if (currentActiveTask !== null) return;
      currentActiveTask = `meditation${index}`;
      disableTaskButtons(index);
      const timerDiv = document.getElementById(`meditationTimer${index}`);
      const display = document.getElementById(`meditationDisplay${index}`);
      timerDiv.classList.remove('hidden');
      document.getElementById('startSound').play();
      document.getElementById('meditationMusic').play();
      startTimer(300, display, () => {
        document.getElementById('meditationMusic').pause();
        document.getElementById('meditationMusic').currentTime = 0;
        document.getElementById('endSound').play();
        timerDiv.classList.add('hidden');
        currentActiveTask = null;
        enableTaskButtons();
      });
    }

    function stopMeditation(index) {
      clearInterval(timerInterval);
      document.getElementById('meditationMusic').pause();
      document.getElementById('meditationMusic').currentTime = 0;
      document.getElementById(`meditationTimer${index}`).classList.add('hidden');
      currentActiveTask = null;
      enableTaskButtons();
    }

    // Pomodoro
    function startPomodoro(index) {
      if (currentActiveTask !== null) return;
      currentActiveTask = `pomodoro${index}`;
      disableTaskButtons(index);
      const timerDiv = document.getElementById(`pomodoroTimer${index}`);
      const display = document.getElementById(`pomodoroDisplay${index}`);
      timerDiv.classList.remove('hidden');
      pomodoroPhase = 'focus';
      pomodoroCycles = 0;
      runPomodoro(index, display, timerDiv);
    }

    function runPomodoro(index, display, timerDiv) {
      const duration = pomodoroPhase === 'focus' ? 1500 : 300;
      document.getElementById('startSound').play();
      startTimer(duration, display, () => {
        document.getElementById('endSound').play();
        if (pomodoroPhase === 'focus') {
          pomodoroPhase = 'break';
          runPomodoro(index, display, timerDiv);
        } else {
          pomodoroCycles++;
          if (pomodoroCycles < 4) {
            pomodoroPhase = 'focus';
            runPomodoro(index, display, timerDiv);
          } else {
            timerDiv.classList.add('hidden');
            currentActiveTask = null;
            enableTaskButtons();
          }
        }
      }, () => {
        display.textContent = `${pomodoroPhase === 'focus' ? 'Focus' : 'Break'}: ${display.textContent}`;
      });
    }

    function stopPomodoro(index) {
      clearInterval(timerInterval);
      document.getElementById(`pomodoroTimer${index}`).classList.add('hidden');
      currentActiveTask = null;
      enableTaskButtons();
    }

    // Notepad
    function saveNotepad(index) {
      if (currentActiveTask !== null && currentActiveTask !== `notepad${index}`) return;
      currentActiveTask = `notepad${index}`;
      disableTaskButtons(index);
      const textarea = document.getElementById(`notepad${index}`);
      const notepadList = document.getElementById(`notepadList${index}`);
      const value = textarea.value.trim();
      if (value && (!notepadStates[index] || !notepadStates[index].includes(value))) {
        notepadStates[index] = notepadStates[index] || [];
        notepadStates[index].push(value);
        const div = document.createElement('div');
        div.className = 'flex items-center space-x-[1vw] mt-[0.5vh]';
        div.innerHTML = `<span class="text-[0.9rem]">${value}</span>`;
        notepadList.appendChild(div);
        document.getElementById('rewardSound').play();
        textarea.value = '';
      }
      currentActiveTask = null;
      enableTaskButtons();
    }

    function clearNotepad(index) {
      if (currentActiveTask !== null && currentActiveTask !== `notepad${index}`) return;
      currentActiveTask = `notepad${index}`;
      disableTaskButtons(index);
      document.getElementById(`notepad${index}`).value = '';
      document.getElementById(`notepadList${index}`).innerHTML = '';
      notepadStates[index] = [];
      currentActiveTask = null;
      enableTaskButtons();
    }

    // Checklist
    function addChecklistItem(index) {
      if (currentActiveTask !== null && currentActiveTask !== `checklist${index}`) return;
      currentActiveTask = `checklist${index}`;
      disableTaskButtons(index);
      const input = document.getElementById(`checklistInput${index}`);
      const checklist = document.getElementById(`checklist${index}`);
      if (input.value.trim()) {
        const div = document.createElement('div');
        div.className = 'flex items-center space-x-[1vw] mt-[0.5vh]';
        div.innerHTML = `
          <input type="checkbox" onchange="if(this.checked) { document.getElementById('rewardSound').play(); this.parentElement.classList.add('line-through text-gray-500'); }" class="w-[4vw] h-[4vw] min-w-[16px] min-h-[16px]">
          <span class="text-[0.9rem]">${input.value}</span>`;
        checklist.appendChild(div);
        input.value = '';
      }
      currentActiveTask = null;
      enableTaskButtons();
    }

    // Focus Block
    function startFocusBlock(index) {
      if (currentActiveTask !== null) return;
      currentActiveTask = `focusBlock${index}`;
      disableTaskButtons(index);
      const timerDiv = document.getElementById(`focusBlockTimer${index}`);
      const display = document.getElementById(`focusBlockDisplay${index}`);
      timerDiv.classList.remove('hidden');
      document.getElementById('startSound').play();
      startTimer(2700, display, () => {
        document.getElementById('endSound').play();
        timerDiv.classList.add('hidden');
        currentActiveTask = null;
        enableTaskButtons();
      });
    }

    function stopFocusBlock(index) {
      clearInterval(timerInterval);
      document.getElementById(`focusBlockTimer${index}`).classList.add('hidden');
      currentActiveTask = null;
      enableTaskButtons();
    }

    // Micro-Task
    function startMicroTask(index) {
      if (currentActiveTask !== null) return;
      currentActiveTask = `microTask${index}`;
      disableTaskButtons(index);
      const timerDiv = document.getElementById(`microTaskTimer${index}`);
      const display = document.getElementById(`microTaskDisplay${index}`);
      timerDiv.classList.remove('hidden');
      document.getElementById('startSound').play();
      startTimer(300, display, () => {
        document.getElementById('endSound').play();
        timerDiv.classList.add('hidden');
        currentActiveTask = null;
        enableTaskButtons();
      });
    }

    function completeMicroTask(index) {
      if (currentActiveTask !== `microTask${index}`) return;
      if (timerInterval) {
        clearInterval(timerInterval);
        document.getElementById('rewardSound').play();
        document.getElementById(`microTaskTimer${index}`).classList.add('hidden');
        currentActiveTask = null;
        enableTaskButtons();
      }
    }

    function stopMicroTask(index) {
      if (currentActiveTask !== `microTask${index}`) return;
      clearInterval(timerInterval);
      document.getElementById(`microTaskTimer${index}`).classList.add('hidden');
      currentActiveTask = null;
      enableTaskButtons();
    }

    // Work-Stretch
    function startWorkStretch(index) {
      if (currentActiveTask !== null) return;
      currentActiveTask = `workStretch${index}`;
      disableTaskButtons(index);
      const timerDiv = document.getElementById(`workStretchTimer${index}`);
      const display = document.getElementById(`workStretchDisplay${index}`);
      timerDiv.classList.remove('hidden');
      pomodoroPhase = 'work';
      runWorkStretch(index, display, timerDiv);
    }

    function runWorkStretch(index, display, timerDiv) {
      const duration = pomodoroPhase === 'work' ? 900 : 300;
      document.getElementById('startSound').play();
      startTimer(duration, display, () => {
        document.getElementById('endSound').play();
        if (pomodoroPhase === 'work') {
          pomodoroPhase = 'stretch';
          runWorkStretch(index, display, timerDiv);
        } else {
          pomodoroPhase = 'work';
          runWorkStretch(index, display, timerDiv);
        }
      }, () => {
        display.textContent = `${pomodoroPhase === 'work' ? 'Work' : 'Stretch'}: ${display.textContent}`;
      });
    }

    function stopWorkStretch(index) {
      if (currentActiveTask !== `workStretch${index}`) return;
      clearInterval(timerInterval);
      document.getElementById(`workStretchTimer${index}`).classList.add('hidden');
      currentActiveTask = null;
      enableTaskButtons();
    }
  </script>
</body>
</html>
